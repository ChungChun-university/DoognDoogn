<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Like</title>
    <style>
        .liked {
            color: red; /* ì¢‹ì•„ìš” ìƒíƒœì¼ ë•Œ í•˜íŠ¸ ìƒ‰ìƒ */
        }
        .not-liked {
            color: gray; /* ì¢‹ì•„ìš” ë¯¸ë“±ë¡ ìƒíƒœì¼ ë•Œ í•˜íŠ¸ ìƒ‰ìƒ */
        }
    </style>
</head>
<body>
<h1>ë‚´ ì¢‹ì•„ìš” ì¡°íšŒ</h1>
<div id="likes-container" th:each="like : ${likes}">
    <p data-post-no="${like.post.postNo}">
        <span class="post-no" style="cursor: pointer;" th:text="${like.post.postNo}"></span><br>
        ìƒì„±ì¼ì: <span th:text="${like.createDate}"></span><br>
        <button class="like-btn liked"> <!-- ì´ˆê¸° ìƒíƒœëŠ” ì±„ì›Œì§„ í•˜íŠ¸ -->
            <span class="heart">â¤ï¸</span>
        </button>
    </p>
</div>

<div id="post-detail" style="display:none;">
    <h2>ê²Œì‹œê¸€ ìƒì„¸ ë‚´ìš©</h2>
    <p id="post-content"></p>
    <button id="close-detail">ë‹«ê¸°</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const userNo = /*[[${userNo}]]*/1; // ì‚¬ìš©ì ë²ˆí˜¸ê°€ ì„œë²„ì—ì„œ ì£¼ì…ë¨

        function fetchPostDetail(postNo) {
            const url = `/post/${postNo}`; // ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ API
            return fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('ê²Œì‹œê¸€ ì¡°íšŒ ì‹¤íŒ¨');
                    return response.json();
                });
        }

        document.getElementById('likes-container').addEventListener('click', (event) => {
            const button = event.target.closest('.like-btn');
            const postNoElement = event.target.closest('.post-no');

            if (button) {
                // í•˜íŠ¸ ìƒíƒœ ë³€ê²½
                button.classList.toggle('liked');
                button.classList.toggle('not-liked');
                const heart = button.querySelector('.heart');
                heart.textContent = button.classList.contains('liked') ? 'â¤ï¸' : 'ğŸ¤'; // í•˜íŠ¸ ìƒíƒœì— ë”°ë¼ ë³€ê²½
            }

            if (postNoElement) {
                const postNo = postNoElement.textContent; // ê²Œì‹œê¸€ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°

                // ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ
                fetchPostDetail(postNo)
                    .then(post => {
                        document.getElementById('post-content').textContent = post.content; // ê²Œì‹œê¸€ ë‚´ìš© ì„¤ì •
                        document.getElementById('post-detail').style.display = 'block'; // ìƒì„¸ ë‚´ìš© í‘œì‹œ
                    })
                    .catch(error => {
                        console.error(error);
                        alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    });
            }
        });

        document.getElementById('close-detail').addEventListener('click', () => {
            document.getElementById('post-detail').style.display = 'none'; // ìƒì„¸ ë‚´ìš© ìˆ¨ê¸°ê¸°
        });
    });
</script>
</body>
</html>