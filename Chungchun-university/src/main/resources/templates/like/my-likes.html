<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Like</title>
    <style>
        .liked {
            color: red; /* 좋아요 상태일 때 하트 색상 */
        }
        .not-liked {
            color: gray; /* 좋아요 미등록 상태일 때 하트 색상 */
        }
    </style>
</head>
<body>
<h1>내 좋아요 조회</h1>
<div id="likes-container" th:each="like : ${likes}">
    <p data-post-no="${like.post.postNo}">
        <span class="post-no" style="cursor: pointer;" th:text="${like.post.postNo}"></span><br>
        생성일자: <span th:text="${like.createDate}"></span><br>
        <button class="like-btn liked"> <!-- 초기 상태는 채워진 하트 -->
            <span class="heart">❤️</span>
        </button>
    </p>
</div>

<div id="post-detail" style="display:none;">
    <h2>게시글 상세 내용</h2>
    <p id="post-content"></p>
    <button id="close-detail">닫기</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const userNo = /*[[${userNo}]]*/1; // 사용자 번호가 서버에서 주입됨

        function fetchPostDetail(postNo) {
            const url = `/post/${postNo}`; // 게시글 상세 조회 API
            return fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('게시글 조회 실패');
                    return response.json();
                });
        }

        document.getElementById('likes-container').addEventListener('click', (event) => {
            const button = event.target.closest('.like-btn');
            const postNoElement = event.target.closest('.post-no');

            if (button) {
                // 하트 상태 변경
                button.classList.toggle('liked');
                button.classList.toggle('not-liked');
                const heart = button.querySelector('.heart');
                heart.textContent = button.classList.contains('liked') ? '❤️' : '🤍'; // 하트 상태에 따라 변경
            }

            if (postNoElement) {
                const postNo = postNoElement.textContent; // 게시글 번호 가져오기

                // 게시글 상세 조회
                fetchPostDetail(postNo)
                    .then(post => {
                        document.getElementById('post-content').textContent = post.content; // 게시글 내용 설정
                        document.getElementById('post-detail').style.display = 'block'; // 상세 내용 표시
                    })
                    .catch(error => {
                        console.error(error);
                        alert('게시글을 불러오는 데 실패했습니다.');
                    });
            }
        });

        document.getElementById('close-detail').addEventListener('click', () => {
            document.getElementById('post-detail').style.display = 'none'; // 상세 내용 숨기기
        });
    });
</script>
</body>
</html>